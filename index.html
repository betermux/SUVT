<!DOCTYPE html>
<html lang="mn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Khalk Store</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Roboto',sans-serif;}
body{background:#121212;color:#fff;overflow-x:hidden;position:relative;}
header{padding:30px 20px;text-align:center;position:relative;height:100px;}
#logo{width:120px;transition: all 0.8s ease;cursor:pointer;}
#user-phone{
    position:absolute;
    top:20px;
    left:calc(20px + 50px + 2px); /* Логоны зүүн + логогийн өргөн + 2px зай */
    font-size:0.9em; /* Жижиг текст */
    opacity:0;
    transition: opacity 0.8s ease;
    font-weight:bold;
    color:#fff;
}

/* Auth */
.container{display:flex;justify-content:center;align-items:flex-start;min-height:90vh;padding-top:50px;}
.card{background:#1e1e1e;padding:40px;border-radius:15px;width:350px;box-shadow:0 5px 25px rgba(0,0,0,0.5);transform: translateY(-50px);opacity:0;animation: slideDown 0.8s forwards;}
@keyframes slideDown{to{transform: translateY(0);opacity:1;}}
.card h2{text-align:center;margin-bottom:30px;}
.card input{width:100%;padding:12px;margin:10px 0;border-radius:8px;border:none;background:#333;color:#fff;}
.card input::placeholder{color:#bbb;}
.card button{width:100%;padding:12px;margin-top:20px;border:none;border-radius:8px;background:#ff5252;color:white;font-weight:bold;cursor:pointer;transition:.3s;}
.card button:hover{background:#ff1744;transform: scale(1.05);}
.switch{text-align:center;margin-top:15px;font-size:.9em;cursor:pointer;color:#ffebee;}
.switch:hover{text-decoration:underline;}

/* Shop */
.shop-container{padding:40px;color:#fff;display:none;}
.shop-title{text-align:center;font-size:2em;margin-bottom:30px;}
.products{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:20px;}
.product-card{background:#1e1e1e;padding:20px;border-radius:12px;text-align:center;transition: transform 0.3s, box-shadow 0.3s;}
.product-card:hover{transform: translateY(-5px);box-shadow:0 10px 25px rgba(0,0,0,0.5);}
.product-card img{width:100%;border-radius:10px;margin-bottom:15px;}
.product-card h3{margin-bottom:10px;}
.product-card p{margin-bottom:15px;}
.product-card button{padding:10px 15px;border:none;border-radius:8px;background:#ff5252;color:#fff;font-weight:bold;cursor:pointer;transition:.3s;}
.product-card button:hover{background:#ff1744;}

/* Cart popup */
#cart-popup{
    display:none;
    position:absolute;
    top:70px;
    left:20px;
    width:300px;
    background:#1e1e1e;
    padding:20px;
    border-radius:12px;
    box-shadow:0 5px 25px rgba(0,0,0,0.5);
    color:#fff;
    z-index:100;
}
#cart-items div{margin-bottom:8px;}
</style>
</head>
<body>
<header>
<img src="assets/khalk.png" alt="Khalk Store Logo" id="logo">
<div id="user-phone"></div>
</header>

<!-- Auth Container -->
<div class="container" id="auth-container">
<div class="card" id="auth-card">
<h2 id="auth-title">Нэвтрэх</h2>
<input type="tel" id="phone" placeholder="Утасны дугаар">
<input type="password" id="password" placeholder="Нууц үг">
<button id="auth-button">Нэвтрэх</button>
<div class="switch" id="switch-auth">Бүртгүүлэх бол энд дарна уу</div>
</div>
</div>

<!-- Shop Container -->
<div class="shop-container" id="shop-container">
<h2 class="shop-title">Бараа</h2>
<div class="products">
<div class="product-card">
<img src="assets/product1.png" alt="Бараа 1">
<h3>Бараа 1</h3>
<p>Үнэ: 150,000₮</p>
<button>Сагсанд нэмэх</button>
</div>
<div class="product-card">
<img src="assets/product2.png" alt="Бараа 2">
<h3>Бараа 2</h3>
<p>Үнэ: 200,000₮</p>
<button>Сагсанд нэмэх</button>
</div>
</div>
</div>

<!-- Cart Popup -->
<div id="cart-popup">
  <h3>Сагс</h3>
  <div id="cart-items"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getDatabase, ref, set, get } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyAEybA-Ou_PGkZINDT-opzVPUlrr6XOU8E",
  authDomain: "khalkh-store.firebaseapp.com",
  databaseURL: "https://khalkh-store-default-rtdb.firebaseio.com",
  projectId: "khalkh-store",
  storageBucket: "khalkh-store.firebasestorage.app",
  messagingSenderId: "205879441792",
  appId: "1:205879441792:web:677a6abe7912d6436a2965",
  measurementId: "G-6M9HZM8G9N"
};

const app = initializeApp(firebaseConfig);
const database = getDatabase(app);

let currentUserPhone = null;

// Elements
const authTitle = document.getElementById('auth-title');
const authButton = document.getElementById('auth-button');
const switchAuth = document.getElementById('switch-auth');
const userPhoneDiv = document.getElementById('user-phone');
const logo = document.getElementById('logo');
const cartPopup = document.getElementById('cart-popup');
const cartItemsDiv = document.getElementById('cart-items');
let isLogin = true;

// Switch login/register
switchAuth.addEventListener('click', () => {
  isLogin = !isLogin;
  authTitle.textContent = isLogin ? 'Нэвтрэх' : 'Бүртгүүлэх';
  authButton.textContent = isLogin ? 'Нэвтрэх' : 'Бүртгүүлэх';
  switchAuth.textContent = isLogin ? 'Бүртгүүлэх бол энд дарна уу' : 'Нэвтрэх бол энд дарна уу';
});

// Login/Register
authButton.addEventListener('click', () => {
  const phone = document.getElementById('phone').value;
  const password = document.getElementById('password').value;
  if(phone === '' || password === '') { alert('Бүх талбарыг бөглөнө үү!'); return; }

  const userRef = ref(database, 'users/' + phone);

  if(isLogin){
    get(userRef).then(snapshot => {
      if(snapshot.exists() && snapshot.val().password === password){
        currentUserPhone = phone;

        // Лого жижигрүүлэх
        logo.style.width = '50px';
        logo.style.position = 'absolute';
        logo.style.top = '20px';
        logo.style.left = '20px';
        logo.style.transition = 'all 0.8s ease';

        // Дугаар харуулах
        userPhoneDiv.textContent = phone;
        userPhoneDiv.style.opacity = '1';
        userPhoneDiv.style.left = '72px'; // 20px + 50px + 2px

        // Auth → Shop
        document.getElementById('auth-container').style.display = 'none';
        document.getElementById('shop-container').style.display = 'block';
        alert(`Амжилттай нэвтэрлээ: ${phone}`);
      } else {
        alert('Дугаар эсвэл нууц үг буруу!');
      }
    });
  } else {
    set(userRef, { password: password })
    .then(() => { alert(`Амжилттай бүртгүүллээ: ${phone}`); })
    .catch(() => { alert('Алдаа гарлаа!'); });
  }

  document.getElementById('phone').value = '';
  document.getElementById('password').value = '';
});

// Add to cart
document.querySelectorAll('.product-card button').forEach((btn)=>{
  btn.addEventListener('click', ()=>{
    if(!currentUserPhone){ alert('Нэвтэрсэн байх шаардлагатай!'); return; }
    const productName = btn.parentElement.querySelector('h3').innerText;
    const productPrice = btn.parentElement.querySelector('p').innerText;

    const cartRef = ref(database, 'users/' + currentUserPhone + '/cart');
    get(cartRef).then(snapshot => {
      let cart = snapshot.exists() ? snapshot.val() : [];
      cart.push({ name: productName, price: productPrice });
      set(cartRef, cart).then(()=> alert(`${productName} сагсанд нэмэгдлээ!`));
    });
  });
});

// Logo click → cart popup
logo.addEventListener('click', ()=>{
  if(!currentUserPhone) return;
  cartPopup.style.display = cartPopup.style.display === 'block' ? 'none' : 'block';

  const cartRef = ref(database, 'users/' + currentUserPhone + '/cart');
  get(cartRef).then(snapshot => {
    cartItemsDiv.innerHTML = '';
    if(snapshot.exists()){
      snapshot.val().forEach(item=>{
        const div = document.createElement('div');
        div.textContent = `${item.name} - ${item.price}`;
        cartItemsDiv.appendChild(div);
      });
    } else {
      cartItemsDiv.textContent = 'Сагс хоосон байна';
    }
  });
});
</script>
</body>
</html>